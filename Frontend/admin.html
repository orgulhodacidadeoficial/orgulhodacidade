<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin - Inscri√ß√µes</title>
  <link href="https://fonts.googleapis.com/css2?family=Blue+Willow:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Ducks+Fiesta&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body{font-family:Inter,Arial,sans-serif;margin:0;background:url('images/FundoMobile.png') center/cover no-repeat fixed;color:#111;-webkit-text-size-adjust:100%;overflow-x:hidden}
    @media (min-width:769px){body{background:url('images/Fundo.png') center/cover no-repeat fixed}}
    
    /* Header e Navigation */
    header{background: linear-gradient(135deg, #4b00d7 0%, #4b00d7 100%);color:#fff;padding:0.4rem 0.5rem;display:flex;align-items:center;justify-content:center;flex-wrap:wrap;gap:0.5rem;box-shadow:0 8px 24px rgba(11,58,145,0.25);position:sticky;top:0;z-index:100;flex-direction:column}
    header h1{font-family:'Blue Willow',serif;font-size:1.1rem;margin:0;font-weight:700;letter-spacing:1px;text-shadow:0 2px 4px rgba(0,0,0,0.3);width:100%;text-align:center}
    
    /* Hamburger Menu - Apenas Mobile/Tablet */
    .menu-toggle{display:none;background:none;border:none;color:#fff;font-size:1.8rem;cursor:pointer;padding:0.5rem;transition:all 0.3s ease;order:1}
    .menu-toggle:hover{transform:scale(1.1)}
    .menu-toggle.active span:nth-child(1){transform:rotate(45deg) translate(8px, 8px)}
    .menu-toggle.active span:nth-child(2){opacity:0}
    .menu-toggle.active span:nth-child(3){transform:rotate(-45deg) translate(7px, -7px)}
    .menu-toggle span{display:block;width:25px;height:3px;background:#fff;margin:5px 0;transition:all 0.3s ease;border-radius:2px}
    
    /* Navigation Sidebar - Apenas Mobile/Tablet */
    nav.sidebar{position:fixed;left:0;top:0;width:100%;height:auto;background:linear-gradient(135deg, #2a0066 0%, #1a0040 100%);color:#fff;padding-top:3.5rem;transition:all 0.4s ease;z-index:99;box-shadow:0 4px 15px rgba(0,0,0,0.3);overflow-y:auto;display:none;flex-direction:column;max-height:calc(100vh - 3.5rem)}
    nav.sidebar.active{display:flex}
    nav.sidebar.show{display:flex}
    .nav-item{padding:1rem 1.5rem;border-bottom:1px solid rgba(255,255,255,0.1);cursor:pointer;transition:all 0.2s ease;display:flex;align-items:center;justify-content:flex-start;gap:0.75rem;width:100%}
    .nav-item:hover{background:rgba(255,255,255,0.1);padding-left:2rem}
    .nav-item-icon{font-size:1.3rem;min-width:30px}
    .nav-item-text{flex:1;text-align:left}
    .menu-buttons{display:flex;flex-direction:column;gap:0.75rem;padding:1rem 1.5rem;border-top:1px solid rgba(255,255,255,0.2)}
    .menu-button{padding:0.75rem;background:#0b5cff;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;text-align:center;transition:all 0.2s ease;font-size:0.95rem}
    .menu-button:hover{background:#0a47cc;transform:scale(1.02)}
    .menu-button.delete{background:#ff4444}
    .menu-button.delete:hover{background:#cc0000}
    
    /* Theme Toggle Switch */
    .theme-switch-wrapper{display:flex;align-items:center;justify-content:space-between;gap:0.75rem;padding:0.75rem;background:#0b5cff;border-radius:6px;cursor:pointer;transition:all 0.2s ease;font-weight:600;user-select:none}
    .theme-switch-wrapper:hover{background:#0a47cc;transform:scale(1.02)}
    .theme-switch-label{flex:1;text-align:left;color:#fff;font-size:0.95rem}
    .toggle-switch{width:50px;height:28px;background:#555;border-radius:14px;position:relative;transition:background 0.3s ease;border:none;cursor:pointer;padding:0;display:flex;align-items:center}
    .toggle-switch.active{background:#ccc}
    .toggle-switch::after{content:'';position:absolute;width:24px;height:24px;background:#fff;border-radius:50%;top:2px;left:2px;transition:left 0.3s ease;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;color:#333}
    .toggle-switch.active::after{left:24px;content:''}
    .toggle-text{font-size:12px;font-weight:bold;min-width:30px;text-align:center}
    .toggle-text.off{color:#666;position:absolute;left:8px}
    .toggle-text.on{color:#fff;position:absolute;right:8px}
    .toggle-switch.active .toggle-text.off{display:none}
    .toggle-switch .toggle-text.on{display:none}
    .toggle-switch.active .toggle-text.on{display:block}
    
    /* Overlay para fechar menu */
    .menu-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:none;z-index:98}
    .menu-overlay.active{display:block}
    
    /* Controls Desktop */
    .controls{display:flex;gap:0.5rem;width:100%;justify-content:center}
    .wrap{max-width:1200px;margin:0.5rem auto;padding:0.75rem;animation:slideIn 0.3s ease}
    @keyframes slideIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .row{display:flex;gap:1rem;flex-wrap:wrap}
    .compact-list{display:flex;flex-direction:column;gap:1rem}
    .inscricao-compact{background:#fff;border-radius:8px;padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
    .compact-row{margin-bottom:0.5rem}
    .compact-datetime{color:#666;font-size:0.85rem;margin-bottom:0.25rem}
    .compact-name{font-weight:600;font-size:1.1rem;margin-bottom:0.25rem}
    .compact-part{color:#0b5cff;font-weight:500;text-transform:capitalize}
    .detail-row{display:grid;grid-template-columns:140px 1fr;gap:0.5rem;padding:0.5rem 0;border-bottom:1px solid #eee}
    .detail-row:last-child{border:none}
    .detail-row strong{color:#555;font-size:0.9rem}
    
    /* Admin tagline - escondido por padr√£o (desktop) */
    .admin-tagline{display:flex;font-size:1.2rem;font-weight:900;background:linear-gradient(135deg, #ff8a00 0%, #ff6b6b 50%, #ffd700 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:shine 3s ease-in-out infinite;letter-spacing:2px;text-transform:uppercase;text-shadow:0 2px 10px rgba(255,138,0,0.3);width:100%;justify-content:center;margin-top:0.2rem}
    @keyframes shine{0%{opacity:0.7;filter:drop-shadow(0 0 5px rgba(255,138,0,0.5))}50%{opacity:1;filter:drop-shadow(0 0 15px rgba(255,138,0,0.8))}100%{opacity:0.7;filter:drop-shadow(0 0 5px rgba(255,138,0,0.5))}}
    
    /* Search and filter styles */
    .section-header{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}
    .section-title{margin:0;color:#0b3a91;font-size:1.5rem}
    .section-stats{color:#ffffff;font-size:0.95rem;font-weight:500}
    .search-filter{display:flex;gap:0.75rem;flex:1;min-width:300px;flex-wrap:wrap}
    .search-input{padding:0.6rem 1rem;border:1px solid #ddd;border-radius:6px;font-size:0.95rem;flex:1;min-width:200px}
    .search-input:focus{outline:none;border-color:#0b5cff;box-shadow:0 0 0 3px rgba(11,92,255,0.1)}
    
    /* Cards Grid */
    .cards-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));gap:1.25rem;margin-top:1rem}
    .data-card{background:linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);border-radius:12px;padding:1.5rem;box-shadow:0 4px 15px rgba(0,0,0,0.08);border-left:5px solid #0b5cff;transition:all 0.3s ease;position:relative;overflow:hidden}
    .data-card::before{content:'';position:absolute;top:0;right:-50px;width:120px;height:120px;background:rgba(11,92,255,0.05);border-radius:50%;transition:all 0.3s ease}
    .data-card:hover{box-shadow:0 12px 35px rgba(0,0,0,0.15);transform:translateY(-4px)}
    .data-card:hover::before{right:-20px;width:150px;height:150px}
    .data-card.contact{border-left-color:#00b37a}
    .data-card.contact::before{background:rgba(0,179,122,0.05)}
    .data-card.contractor{border-left-color:#ff7a00}
    .data-card.contractor::before{background:rgba(255,122,0,0.05)}
    .card-field{margin-bottom:1rem;display:flex;flex-direction:column;position:relative;z-index:1}
    .card-field:last-of-type{margin-bottom:0.5rem}
    .card-field-label{font-size:0.8rem;color:#666;text-transform:uppercase;font-weight:700;letter-spacing:1px;margin-bottom:0.35rem;display:flex;align-items:center;gap:0.4rem}
    .card-field-value{font-size:1rem;color:#1a1a1a;font-weight:600;word-break:break-word;padding:0.5rem 0.75rem;background:rgba(255,255,255,0.6);border-radius:6px;border-left:3px solid rgba(11,92,255,0.2)}
    .card-actions{display:flex;gap:0.75rem;margin-top:1.5rem;padding-top:1.25rem;border-top:2px solid rgba(0,0,0,0.05);position:relative;z-index:1}
    
    @media (max-width: 768px) {
      header{padding:0.5rem 1rem;gap:0.4rem;flex-direction:column;justify-content:center;align-items:center;min-height:auto}
      header h1{font-size:0.95rem;margin:0;text-align:center;order:-2;width:100%;font-weight:700}
      .menu-toggle{display:block;order:-1;position:absolute;left:0.5rem;top:0.5rem;z-index:200}
      .menu-toggle span{width:24px;height:2.5px;margin:4px 0}
      .admin-tagline{display:flex !important;order:1;font-size:0.75rem;font-weight:800;background:linear-gradient(135deg, #ff8a00 0%, #ff6b6b 35%, #ffd700 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:shimmer-mobile 2.5s ease-in-out infinite;letter-spacing:1px;text-transform:uppercase;width:100%;justify-content:center;margin-top:0.1rem;white-space:normal;text-shadow:0 0 20px rgba(255,138,0,0.2);filter:drop-shadow(0 0 8px rgba(255,138,0,0.3))}
      @keyframes shimmer-mobile{0%{opacity:0.75;transform:scale(1);filter:drop-shadow(0 0 5px rgba(255,138,0,0.3))}50%{opacity:1;transform:scale(1.02);filter:drop-shadow(0 0 15px rgba(255,138,0,0.6))}100%{opacity:0.75;transform:scale(1);filter:drop-shadow(0 0 5px rgba(255,138,0,0.3))}}
      #navInscri√ß√µes .nav-item-text,#navContatos .nav-item-text,#navContratacoes .nav-item-text{font-family:'Ducks Fiesta',sans-serif}
      .controls{display:none !important}
      .wrap{padding:0.5rem;margin:0;margin-top:0.25rem}
      .cards-grid{grid-template-columns:1fr}
      .section-header{flex-direction:column;align-items:flex-start}
      .search-filter{min-width:100%}
    }
    /* Modal styles */
    .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;padding:0.5rem}
    .modal-content{background:#fff;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.15);width:92%;max-width:800px;max-height:90vh;overflow-y:auto;position:relative}
    .modal-header{padding:1rem;border-bottom:1px solid #eee;position:sticky;top:0;background:#fff;display:flex;justify-content:space-between;align-items:center;z-index:1}
    .modal-body{padding:1.5rem}
    .modal-actions{padding:1.5rem;border-top:1px solid rgba(255,255,255,0.1);display:flex;justify-content:flex-end;gap:0.75rem;background:rgba(0,0,0,0.2)}
    .btn-close{position:absolute;right:1rem;top:1rem;background:rgba(255,255,255,0.2);border:none;font-size:1.8rem;cursor:pointer;padding:0.25rem;line-height:1;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;transition:all 0.3s ease}
    .btn-close:hover{background:rgba(255,255,255,0.3);transform:scale(1.1)}
    .btn-close-delete{position:absolute;right:1rem;top:1rem;background:rgba(255,255,255,0.2);border:none;font-size:1.8rem;cursor:pointer;padding:0.25rem;line-height:1;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;transition:all 0.3s ease}
    .btn-close-delete:hover{background:rgba(255,255,255,0.3);transform:scale(1.1)}
    .preview-table{width:100%;border-collapse:collapse;margin:0;background:rgba(0,0,0,0.3);border-radius:8px;overflow:hidden;font-size:1rem}
    .preview-table th{text-align:left;background:rgba(255,138,0,0.15);font-weight:700;width:200px;color:#fff;border:none;text-transform:uppercase;letter-spacing:0.5px;font-size:0.9rem;padding:1rem}
    .preview-table th,.preview-table td{padding:1rem;border:none;vertical-align:top;border-bottom:1px solid rgba(255,255,255,0.05)}
    .preview-table tr:last-child th,.preview-table tr:last-child td{border-bottom:none}
    .preview-table tr:nth-child(odd) {background:rgba(255,255,255,0.02)}
    .preview-table td{color:#e0e0e0;font-size:1rem;word-break:break-word}
    .btn-download{background:linear-gradient(135deg, #0b5cff 0%, #0a47cc 100%);color:#fff;border:none;padding:0.75rem 1.5rem;border-radius:8px;cursor:pointer;font-size:0.95rem;font-weight:600;transition:all 0.3s ease;text-transform:uppercase;letter-spacing:0.5px;box-shadow:0 6px 20px rgba(11,92,255,0.3)}
    .btn-download:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(11,92,255,0.5)}
    .btn-cancel{background:rgba(255,255,255,0.1);color:#aaa;border:1px solid rgba(255,255,255,0.2)}
    .btn-cancel:hover{background:rgba(255,255,255,0.15);color:#fff;border-color:rgba(255,255,255,0.3);transform:translateY(-2px)}
    @media (max-width: 768px) {
      .modal-overlay{padding:0;align-items:flex-start}
      .modal-content{width:100%;max-height:auto;border-radius:0;margin-top:0}
      .modal-header{padding:0.75rem}
      .modal-body{padding:0.75rem}
      .modal-actions{padding:0.75rem;gap:0.5rem;flex-wrap:wrap}
      .preview-table{font-size:0.9rem}
      .preview-table th{width:110px;white-space:nowrap;font-size:0.8rem}
      .preview-table th,.preview-table td{padding:0.5rem;font-size:0.9rem}
      .btn-download,.btn-cancel{width:100%;padding:0.75rem;font-size:0.95rem;text-align:center}
    }
    .card{background: #4b00d74a;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,0.06);padding:1.25rem;flex:1;min-width:300px;margin-top:1rem}
    table{width:100%;border-collapse:collapse;font-size:0.95rem}
    th{padding:0.75rem;border-bottom:2px solid #ddd;text-align:left;font-weight:600;color:#444}
    td{padding:0.75rem;border-bottom:1px solid #eee;text-align:left}
    td pre{margin:0;font-family:inherit;font-size:inherit}
    tr:hover{background:#f8f9ff}
    .controls{display:flex;gap:0.5rem}
    button{background:#baa6dfad;color:#fff;border:none;padding:0.45rem 0.6rem;border-radius:6px;cursor:pointer;white-space:nowrap;font-size:0.9rem;transition:all 0.2s ease}
    button:hover{opacity:0.9;transform:translateY(-1px)}
    .logout{background:#dc2626}
    .btn-delete{background:#dc2626}
    .btn-delete:hover{background:#b91c1c}
    #btnRelatorio{background:#3d79d1;;color:#fff;padding:0.6rem 1rem;border:none;border-radius:6px;cursor:pointer;font-weight:500;transition:all 0.2s ease}
    #btnRelatorio:hover{background:#003a8f;transform:translateY(-2px);box-shadow:0 2px 8px rgba(0,70,173,0.3)}
    #btnRelatorio:active{transform:translateY(0)}
    pre{white-space:pre-wrap;word-break:break-word}
    #site-admin-badge{display:none!important}
    
    /* Dark Mode (padr√£o) e Light Mode */
    :root {
      --bg-primary: #111;
      --bg-secondary: #fff;
      --text-primary: #111;
      --text-secondary: #fff;
      --card-bg: #fff;
      --card-text: #333;
      --input-bg: #fff;
      --input-border: #ddd;
      --header-bg: linear-gradient(135deg, #4b00d7 0%, #4b00d7 100%);
      --sidebar-bg: linear-gradient(135deg, #2a0066 0%, #1a0040 100%);
    }
    
    body.light-mode {
      --bg-primary: #f5f5f5;
      --bg-secondary: #222;
      --text-primary: #1a1a1a;
      --text-secondary: #f5f5f5;
      --card-bg: #f9f9f9;
      --card-text: #222;
      --input-bg: #fff;
      --input-border: #ccc;
      --header-bg: linear-gradient(135deg, #6f42c1 0%, #6f42c1 100%);
      --sidebar-bg: linear-gradient(135deg, #8860d8 0%, #7248b8 100%);
    }
    
    body.light-mode {
      background-color: var(--bg-primary) !important;
      color: var(--text-primary) !important;
    }
    
    body.light-mode header {
      background: var(--header-bg) !important;
    }
    
    body.light-mode nav.sidebar {
      background: var(--sidebar-bg) !important;
    }
    
    body.light-mode .data-card,
    body.light-mode .modal-content,
    body.light-mode .card {
      background: var(--card-bg) !important;
      color: var(--card-text) !important;
    }
    
    body.light-mode .search-input,
    body.light-mode input,
    body.light-mode textarea {
      background: var(--input-bg) !important;
      border-color: var(--input-border) !important;
      color: var(--card-text) !important;
    }
    
    body.light-mode table,
    body.light-mode th,
    body.light-mode td {
      color: var(--card-text) !important;
      border-color: var(--input-border) !important;
    }
    
    body.light-mode .modal-header,
    body.light-mode .modal-body,
    body.light-mode .modal-actions {
      background: var(--card-bg) !important;
      color: var(--card-text) !important;
      border-color: var(--input-border) !important;
    }
    
    /* Modal Profissional */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 10000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal-content {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 0 0 40px rgba(255, 138, 0, 0.2);
      max-width: 420px;
      width: 90%;
      padding: 0;
      overflow: hidden;
      border: 1px solid rgba(255, 138, 0, 0.15);
      animation: slideUp 0.3s ease;
    }
    
    .modal-header {
      background: linear-gradient(90deg, #ff8a00 0%, #e52e71 50%, #6a00ff 100%);
      padding: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: white;
    }
    
    .modal-header-icon {
      font-size: 28px;
    }
    
    .modal-header-title {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
      letter-spacing: 0.5px;
    }
    
    .modal-body {
      padding: 24px;
      text-align: center;
    }
    
    .modal-body-title {
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      margin: 0 0 12px 0;
    }
    
    .modal-body-text {
      font-size: 14px;
      color: #aaa;
      line-height: 1.5;
      margin: 0;
    }
    
    .modal-actions {
      padding: 20px 24px;
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      background: rgba(0, 0, 0, 0.3);
    }
    
    .modal-btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    
    .modal-btn-cancel {
      background: rgba(255, 255, 255, 0.1);
      color: #aaa;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .modal-btn-cancel:hover {
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    .modal-btn-confirm {
      background: linear-gradient(135deg, #ff8a00 0%, #e52e71 100%);
      color: white;
      border: none;
      box-shadow: 0 6px 20px rgba(229, 46, 113, 0.4);
    }
    
    .modal-btn-confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 28px rgba(229, 46, 113, 0.6);
    }
    
    .modal-btn-confirm:active {
      transform: translateY(0);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @media (max-width: 768px) {
      .card{padding:0.75rem;border-radius:6px;margin-top:0.75rem}
      table{font-size:0.85rem}
      th,td{padding:0.4rem}
      button{padding:0.4rem 0.5rem;font-size:0.85rem}
      #btnRelatorio{font-size:0.85rem}
      .modal-content {
        width: 85%;
        max-width: 100%;
      }
    }
  </style>
  <!-- √çcones do site (favicon) -->
  <link rel="icon" type="image/png" sizes="32x32" href="logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="logo.png">
  <link rel="shortcut icon" href="logo.png" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="180x180" href="logo.png">
  <meta name="theme-color" content="#ff8a00">
</head>
<body>
  <header>
    <button class="menu-toggle" id="menuToggle">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <h1>Painel Administrativo</h1>
    <span class="admin-tagline">#esseboi√©SHOW!</span>
    <div class="controls">
      <button id="btnHome" onclick="window.location.href='index.html'" style="background:#e00606;">Ir para o Site</button>
      <button id="btnIns">Carregar Inscri√ß√µes</button>
      <button id="btnCont">Carregar Contatos</button>
      <button id="btnConr">Carregar Contrata√ß√µes</button>
      <button id="btnLogout" class="logout">Sair</button>
    </div>
  </header>

  <!-- Menu Sidebar - Apenas Mobile/Tablet -->
  <nav class="sidebar" id="sidebar">
    <div class="nav-item" id="navInscri√ß√µes">
      <span class="nav-item-icon">üìù</span>
      <span class="nav-item-text">Inscri√ß√µes</span>
    </div>
    <div class="nav-item" id="navContatos">
      <span class="nav-item-icon">üìß</span>
      <span class="nav-item-text">Contatos</span>
    </div>
    <div class="nav-item" id="navContratacoes">
      <span class="nav-item-icon">üé≠</span>
      <span class="nav-item-text">Contrata√ß√µes</span>
    </div>
    <div class="menu-buttons">
      <button class="menu-button" id="navHome">üè† Ir para o Site</button>
      <div class="theme-switch-wrapper" id="themeSwitch">
        <span class="theme-switch-label" id="themeLabelText">üåô Tema Escuro</span>
        <button class="toggle-switch" id="themeToggle">
          <span class="toggle-text off">OFF</span>
          <span class="toggle-text on">ON</span>
        </button>
      </div>
      <button class="menu-button delete" id="navLogout">üîê Sair</button>
    </div>
  </nav>

  <!-- Overlay para fechar menu -->
  <div class="menu-overlay" id="menuOverlay"></div>

   
  <div class="wrap">
    <div id="content"></div>
  </div>

  <script>
    const contentEl = document.getElementById('content');
    async function fetchJson(url){
      const r = await fetch(url, { credentials: 'include' });
      if (!r.ok) throw new Error('Falha ao carregar');
      return r.json();
    }

  // render inscri√ß√µes with a chart by tipo_participacao
  // On mobile/tablet we show a compact list (date/time, name, participation)
  // with a per-person expandable details panel to keep the admin list readable.
  function renderInscricoes(arr){
        if (!Array.isArray(arr) || arr.length === 0) {
          contentEl.innerHTML = `<div class="card"><h3>Inscri√ß√µes</h3><p>Nenhum registro encontrado.</p></div>`;
          return;
        }

        // preserve original indices so deletes map to file order
        const withIndex = arr.map((v, i) => Object.assign({}, v, { _origIndex: i }));

        // sort by receivedAt (timestamp) desc
        const sorted = withIndex.slice().sort((a, b) => (b.receivedAt || 0) - (a.receivedAt || 0));

        // count types for chart
        const counts = {};
        sorted.forEach(item => {
          const t = (item.tipo_participacao || 'Outros').toString().trim().toLowerCase();
          counts[t] = (counts[t] || 0) + 1;
        });
        console.log('Contagem de tipos:', counts);

        // build html with canvas for chart and either a table (desktop)
        // ou cards (mobile/tablet). Detecta viewport width
        const isCompact = true; // Sempre usar cards

        let html = `<div class="card" style="border:3px solid #ff8a00;background:linear-gradient(135deg, rgb(0 0 0 / 54%) 0%, rgba(0, 70, 173, 0.02) 100%);box-shadow:0 0 20px rgba(255,138,0,0.15), 0 8px 24px rgba(0,0,0,0.1)">
          <div style="display:flex;align-items:center;justify-content:center;flex-direction:column;margin-bottom:1rem;gap:1rem;padding-bottom:1rem;border-bottom:2px solid #ff8a00">
            <h3 style="margin:0;font-family:'Ducks Fiesta','Poppins','Trebuchet MS','Gill Sans',sans-serif;color:#ff8a00;font-size:1.8rem;font-weight:900;letter-spacing:1.5px;text-shadow:0 2px 8px rgba(0,0,0,0.15);text-transform:uppercase;width:100%;text-align:center">üìä Inscri√ß√µes</h3>
            <div style="display:flex;gap:0.75rem;flex-wrap:wrap;width:100%;justify-content:center;flex-direction:column">
              <button id="btnRelatorio" style="width:100%">üìã Gerar Relat√≥rio</button>
              <button id="clearInsBtn" class="btn-delete" style="padding:0.6rem 1rem;width:100%">üóëÔ∏è Limpar todos</button>
            </div>
          </div>
          <div style="height:300px;margin-bottom:1.5rem"><canvas id="insChart"></canvas></div>`;

        // Build either a full table (desktop) or a compact list (mobile/tablet)
        if (!isCompact) {
          // Desktop: show full table + chart
          const keys = new Set();
          withIndex.forEach(v => Object.keys(v).forEach(k => keys.add(k)));
          // Remove specific fields from desktop view
          keys.delete('receivedAt');
          keys.delete('_origIndex');
          keys.delete('ip');
          keys.delete('email');
          const otherKeys = Array.from(keys);

          html += `<div class="table-responsive"><table><thead><tr><th>Recebido</th>`;
          otherKeys.forEach(h=> html += `<th>${h}</th>`);
          html += `<th>A√ß√µes</th></tr></thead><tbody>`;

          sorted.forEach(item => {
            html += '<tr>';
            const ts = item.receivedAt ? new Date(Number(item.receivedAt)).toLocaleString('pt-BR', {
              day: '2-digit',
              month: '2-digit',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            }) : '';
            html += `<td><pre>${ts}</pre></td>`;
            otherKeys.forEach(h=>{
              let v = item[h];
              if (v === undefined) v = '';
              if (typeof v === 'object') v = JSON.stringify(v);
              if (h === 'nome') {
                v = String(v).toUpperCase();
              } else if (h === 'bairro') {
                v = String(v).toUpperCase();
              } else if (h === 'tipo_participacao') {
                v = String(v).toLowerCase();
                v = v.charAt(0).toUpperCase() + v.slice(1);
              }
              if (h === 'telefone') {
                v = `üì± ${v}`;
              }
              html += `<td><pre>${String(v)}</pre></td>`;
            });
            // actions: View (Word) + Delete
            html += `<td style="white-space:nowrap">`;
            html += `<button data-idx="${item._origIndex}" class="verIns" style="background:#0b5cff;margin-right:6px">ÔøΩ Ver</button>`;
            html += `<button data-idx="${item._origIndex}" class="delIns" style="background:#dc2626">üóëÔ∏è</button>`;
            html += `</td>`;
            html += '</tr>';
          });
          html += `</tbody></table></div></div>`;
        } else {
          // Mobile/tablet: show as cards (same format as contatos and contrata√ß√µes)
          
          html += `
          <div class="search-filter">
            <input type="text" id="searchInscricoes" class="search-input" placeholder="üîç Buscar inscri√ß√µes por nome ou participa√ß√£o...">
          </div>
          
          <div class="cards-grid" id="inscricoesGrid"></div>
          </div>`;
          
          contentEl.innerHTML = html;
          const grid = document.getElementById('inscricoesGrid');
          const searchInput = document.getElementById('searchInscricoes');
          
          // Attach event listener to the "Gerar Relat√≥rio" button
          const btnRelatorio = document.getElementById('btnRelatorio');
          if (btnRelatorio) {
            btnRelatorio.addEventListener('click', () => {
              console.log('[DEBUG] Bot√£o Gerar Relat√≥rio clicado');
              try {
                const url = './relatorio-inscricoes.html';
                console.log('[DEBUG] Abrindo URL:', url);
                window.open(url, '_blank');
              } catch (err) {
                console.error('[ERROR] Erro ao abrir relat√≥rio:', err);
                alert('Erro ao abrir relat√≥rio: ' + err.message);
              }
            });
          }
          
          function renderCards(items) {
            if (items.length === 0) {
              grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:2rem;color:#999">Nenhum resultado encontrado</div>';
              return;
            }
            
            const getColorByType = (tipo) => {
              const tipoLower = (tipo || '').toLowerCase().trim();
              if (tipoLower === 'vaqueiro') return { border: '#0b5cff', bg: '#b4cff7' }; // Azul
              if (tipoLower === 'indio') return { border: '#dc2626', bg: '#cfa2a2' }; // Vermelho
              if (tipoLower === 'india') return { border: '#f59e0b', bg: '#efdba4' }; // Amarelo
              return { border: '#0b5cff', bg: '#f0f6ff' }; // Padr√£o azul
            };
            
            grid.innerHTML = items.map((item) => {
              const originalIdx = item._origIndex;
              const nome = item.nome || 'Sem nome';
              const tipo = item.tipo_participacao || '-';
              const telefone = item.telefone || item.phone || '-';
              const bairro = item.bairro || '-';
              const idade = item.idade || item.age || '-';
              const colors = getColorByType(tipo);
              
              return `
                <div class="data-card" style="border-left-color:${colors.border};background:${colors.bg}">
                  <div class="card-field">
                    <div class="card-field-label">üë§ Nome</div>
                    <div class="card-field-value">${nome}</div>
                  </div>
                  <div class="card-field">
                    <div class="card-field-label">üé≠ Tipo de Participa√ß√£o</div>
                    <div class="card-field-value" style="background:linear-gradient(135deg, rgba(${colors.border.match(/\w\w/g).map(x => parseInt(x, 16)).join(',')}, 0.1) 0%, rgba(${colors.border.match(/\w\w/g).map(x => parseInt(x, 16)).join(',')}, 0.05) 100%);border-left-color:${colors.border}">${tipo}</div>
                  </div>
                  <div class="card-field">
                    <div class="card-field-label">üì± Telefone</div>
                    <div class="card-field-value"><a href="tel:${telefone}" style="color:#0b5cff;text-decoration:none;font-weight:700">${telefone}</a></div>
                  </div>
                  <div class="card-field">
                    <div class="card-field-label">üè† Bairro</div>
                    <div class="card-field-value">${bairro}</div>
                  </div>
                  ${idade !== '-' ? `<div class="card-field">
                    <div class="card-field-label">üéÇ Idade</div>
                    <div class="card-field-value">${idade} anos</div>
                  </div>` : ''}
                  ${item.receivedAt ? `<div class="card-field">
                    <div class="card-field-label">üìÖ Data da Inscri√ß√£o</div>
                    <div class="card-field-value" style="font-size:0.9rem">${new Date(Number(item.receivedAt)).toLocaleDateString('pt-BR')} ‚Ä¢ ${new Date(Number(item.receivedAt)).toLocaleTimeString('pt-BR')}</div>
                  </div>` : ''}
                  <div class="card-actions">
                    <button data-idx="${originalIdx}" class="verIns" style="flex:1;background:linear-gradient(135deg, #0b5cff 0%, #0a47cc 100%);color:#fff;border:none;padding:0.75rem;border-radius:8px;font-weight:700;cursor:pointer;transition:all 0.3s ease;text-transform:uppercase;font-size:0.85rem;letter-spacing:0.5px"> Ver Detalhes</button>
                    <button data-idx="${originalIdx}" class="delIns" style="flex:1;background:linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);color:#fff;border:none;padding:0.75rem;border-radius:8px;font-weight:700;cursor:pointer;transition:all 0.3s ease;text-transform:uppercase;font-size:0.85rem;letter-spacing:0.5px">üóëÔ∏è Excluir</button>
                  </div>
                </div>
              `;
            }).join('');
            
            // Reattach event handlers
            document.querySelectorAll('.verIns').forEach(btn => btn.addEventListener('click', viewInscricao));
            document.querySelectorAll('.delIns').forEach(btn => btn.addEventListener('click', deleteInscricao));
          }
          
          function viewInscricao(e) {
            const idx = Number(e.currentTarget.getAttribute('data-idx'));
            const item = arr[idx];
            if (!item) return alert('Inscri√ß√£o n√£o encontrada');
            showInscricaoPreview(item);
          }
          
          function showDeleteConfirmModal(nome, onConfirm, onCancel) {
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay active';
            overlay.style.zIndex = '2000';
            
            const modal = document.createElement('div');
            modal.className = 'modal-content';
            modal.style.maxWidth = '450px';
            
            modal.innerHTML = `
              <div class="modal-header" style="background:linear-gradient(135deg, #ff4757 0%, #ff6b7a 100%)">
                <div style="flex:1">
                  <h2 style="margin:0;font-size:1.2rem;font-weight:700;letter-spacing:0.5px">‚ö†Ô∏è CONFIRMAR EXCLUS√ÉO</h2>
                </div>
                <button class="btn-close-delete">&times;</button>
              </div>
              <div class="modal-body" style="text-align:center">
                <p style="font-size:1rem;margin:0 0 0.5rem 0;color:#fff;font-weight:600">Deseja excluir a inscri√ß√£o de:</p>
                <p style="font-size:1.1rem;margin:0.5rem 0 1.5rem 0;color:#ff4757;font-weight:700;text-transform:uppercase">${nome}</p>
                <p style="font-size:0.9rem;margin:0;color:#fff;line-height:1.4">Esta a√ß√£o <strong>n√£o pode ser desfeita</strong>. Para confirmar, digite a palavra:</p>
                <p style="font-size:1.2rem;margin:1rem 0;font-weight:700;letter-spacing:2px;color:#ff4757">CONFIRMAR</p>
                <input type="text" id="deleteConfirmInput" placeholder="Digite aqui..." style="width:100%;padding:0.75rem;border:2px solid #ff4757;border-radius:8px;font-size:1rem;margin-bottom:1.5rem;box-sizing:border-box;font-weight:600;color:#1a0040">
              </div>
              <div class="modal-actions">
                <button class="btn-download deleteConfirm" style="flex:1;background:linear-gradient(135deg, #ff4757 0%, #ff6b7a 100%);color:#fff;font-weight:700" disabled>üóëÔ∏è EXCLUIR</button>
                <button class="btn-download btn-cancel deleteCancel" style="flex:1;background:rgba(0,0,0,0.15);color:#fff;font-weight:700;border:2px solid rgba(255,255,255,0.2)">‚úï CANCELAR</button>
              </div>
            `;
            
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            const input = modal.querySelector('#deleteConfirmInput');
            const confirmBtn = modal.querySelector('.deleteConfirm');
            const cancelBtn = modal.querySelector('.deleteCancel');
            const closeBtn = modal.querySelector('.btn-close-delete');
            
            input.focus();
            
            input.addEventListener('input', () => {
              confirmBtn.disabled = input.value.toUpperCase() !== 'CONFIRMAR';
              if (input.value.toUpperCase() === 'CONFIRMAR') {
                confirmBtn.style.opacity = '1';
                confirmBtn.style.cursor = 'pointer';
              } else {
                confirmBtn.style.opacity = '0.6';
                confirmBtn.style.cursor = 'not-allowed';
              }
            });
            
            function closeModal() {
              try { overlay.remove(); } catch (e) {}
            }
            
            confirmBtn.addEventListener('click', () => {
              if (input.value.toUpperCase() === 'CONFIRMAR') {
                closeModal();
                onConfirm();
              }
            });
            
            cancelBtn.addEventListener('click', closeModal);
            closeBtn.addEventListener('click', closeModal);
            
            overlay.addEventListener('click', (e) => {
              if (e.target === overlay) closeModal();
            });
          }
          
          function deleteInscricao(e) {
            const idx = Number(e.currentTarget.getAttribute('data-idx'));
            const nome = arr[idx].nome || 'Inscri√ß√£o';
            
            showDeleteConfirmModal(nome, async () => {
              try {
                const r = await fetch('/api/admin/inscricoes/delete', {
                  method: 'POST',
                  credentials: 'include',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ index: idx })
                });
                if (!r.ok) {
                  const errData = await r.json().catch(() => ({ error: 'Erro ao deletar' }));
                  throw new Error(errData.error || `Erro ${r.status}`);
                }
                
                // Modal de sucesso
                const overlay = document.createElement('div');
                overlay.className = 'modal-overlay active';
                overlay.style.zIndex = '2001';
                const modal = document.createElement('div');
                modal.className = 'modal-content';
                modal.style.maxWidth = '400px';
                modal.innerHTML = `
                  <div class="modal-header" style="background:linear-gradient(135deg, #00b37a 0%, #2cce71 100%);text-align:center">
                    <h2 style="margin:0;font-size:1.2rem;font-weight:700;letter-spacing:0.5px">‚úÖ SUCESSO!</h2>
                  </div>
                  <div class="modal-body" style="text-align:center">
                    <p style="font-size:1rem;color:#00b37a;font-weight:700">Inscri√ß√£o exclu√≠da com sucesso</p>
                  </div>
                  <div class="modal-actions">
                    <button class="btn-download successClose" style="flex:1;background:linear-gradient(135deg, #00b37a 0%, #2cce71 100%);color:#fff">OK</button>
                  </div>
                `;
                overlay.appendChild(modal);
                document.body.appendChild(overlay);
                
                modal.querySelector('.successClose').addEventListener('click', async () => {
                  overlay.remove();
                  try { 
                    const data = await fetchJson('/api/admin/inscricoes'); 
                    renderInscricoes(data); 
                  } catch(e) { 
                    console.error('Erro ao recarregar:', e);
                  }
                });
              } catch (err) {
                console.error('Erro ao deletar inscri√ß√£o:', err);
                
                // Modal de erro
                const overlay = document.createElement('div');
                overlay.className = 'modal-overlay active';
                overlay.style.zIndex = '2001';
                const modal = document.createElement('div');
                modal.className = 'modal-content';
                modal.style.maxWidth = '400px';
                modal.innerHTML = `
                  <div class="modal-header" style="background:linear-gradient(135deg, #ff4757 0%, #ff6b7a 100%);text-align:center">
                    <h2 style="margin:0;font-size:1.2rem;font-weight:700;letter-spacing:0.5px">‚ùå ERRO</h2>
                  </div>
                  <div class="modal-body" style="text-align:center">
                    <p style="font-size:0.95rem;color:#ff4757;font-weight:600">${err.message}</p>
                  </div>
                  <div class="modal-actions">
                    <button class="btn-download errorClose" style="flex:1;background:linear-gradient(135deg, #ff4757 0%, #ff6b7a 100%);color:#fff">OK</button>
                  </div>
                `;
                overlay.appendChild(modal);
                document.body.appendChild(overlay);
                
                modal.querySelector('.errorClose').addEventListener('click', () => {
                  overlay.remove();
                });
              }
            });
          }
          
          renderCards(sorted);
          
          // Renderizar gr√°fico DEPOIS que o DOM estiver pronto
          setTimeout(() => {
            const labels = Object.keys(counts).map(l => l.charAt(0).toUpperCase() + l.slice(1));
            const data = Object.keys(counts).map(l => counts[l]);
            console.log('Labels:', labels);
            console.log('Data:', data);
            console.log('Counts:', counts);
            
            function onceLoaded(){
              try{
                const ctx = document.getElementById('insChart');
                if (!ctx) {
                  console.error('Canvas insChart n√£o encontrado');
                  return;
                }
                const canvasCtx = ctx.getContext('2d');
                // eslint-disable-next-line no-undef
                new Chart(canvasCtx, {
                  type: 'bar',
                  data: {
                    labels,
                    datasets: [{
                      label: 'Quantidade',
                      data,
                      backgroundColor: ['#0b5cff','#ff7a00','#00b37a','#7a3cff']
                    }]
                  },
                  options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                      title: { display: false },
                      legend: { display: false },
                      tooltip: { enabled: true }
                    },
                    scales: {
                      y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 }
                      },
                      x: {
                        ticks: {
                          color: '#ffffff',
                          font: { size: 12, weight: 'bold' }
                        }
                      }
                    }
                  }
                });
              }catch(e){ console.error('Erro ao renderizar gr√°fico', e); }
            }
            if (window.Chart) return onceLoaded();
            const s = document.createElement('script');
            s.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js';
            s.onload = onceLoaded; s.onerror = ()=>console.warn('N√£o foi poss√≠vel carregar Chart.js');
            document.head.appendChild(s);
          }, 100);
          
          searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = sorted.filter(item => {
              const nome = (item.nome || '').toLowerCase();
              const tipo = (item.tipo_participacao || '').toLowerCase();
              return nome.includes(term) || tipo.includes(term);
            });
            renderCards(filtered);
          });
          
          // Bot√£o de limpar todas as inscri√ß√µes (mobile/cards)
          const clearBtn = document.getElementById('clearInsBtn');
          console.log('[INSCRI√á√ïES CARDS] clearBtn:', clearBtn);
          if (clearBtn) {
            clearBtn.addEventListener('click', async ()=>{
              const total = arr.length;
              if (!confirm(`‚ö†Ô∏è ATEN√á√ÉO!\n\nVoc√™ est√° prestes a APAGAR TODAS AS ${total} ${total === 1 ? 'INSCRI√á√ÉO' : 'INSCRI√á√ïES'}!\n\nEsta a√ß√£o n√£o pode ser desfeita!`)) {
                return;
              }
              
              const confirmText = prompt('Para confirmar, digite CONFIRMAR em mai√∫sculas:');
              if (confirmText !== 'CONFIRMAR') {
                alert('‚ùå Opera√ß√£o cancelada!');
                return;
              }
              
              try{
                const r = await fetch('/api/admin/inscricoes/clear', { method: 'POST', credentials: 'include' });
                if (!r.ok) throw new Error('Falha ao limpar as inscri√ß√µes');
                alert(`‚úÖ ${total} ${total === 1 ? 'inscri√ß√£o foi' : 'inscri√ß√µes foram'} removida(s) com sucesso`);
                try { 
                  const data = await fetchJson('/api/admin/inscricoes'); 
                  renderInscricoes(data); 
                } catch(e) { 
                  console.error('Erro ao recarregar:', e);
                }
              }catch(e){ 
                alert('‚ùå Erro: ' + e.message); 
              }
            });
          }
          
          return;
        }
        
        html += `</div>`;
        contentEl.innerHTML = html;
        contentEl.innerHTML = html;

        // attach toggle handlers for compact details
        document.querySelectorAll('.btn-toggle-details').forEach(btn=> btn.addEventListener('click', function(){
          const idx = this.getAttribute('data-idx');
          const el = document.querySelector('.inscricao-compact[data-idx="'+idx+'"] .inscricao-details');
          if (!el) return; el.style.display = (el.style.display === 'none') ? 'block' : 'none';
        }));

        // attach Ver (download Word) handlers
        attachVerHandlers(withIndex);

        // Bot√£o de limpar todas as inscri√ß√µes
        setTimeout(() => {
          const clearBtn = document.getElementById('clearInsBtn');
          console.log('[INSCRI√á√ïES] clearBtn:', clearBtn);
          if (clearBtn) {
            clearBtn.addEventListener('click', async ()=>{
              const total = arr.length;
              if (!confirm(`‚ö†Ô∏è ATEN√á√ÉO!\n\nVoc√™ est√° prestes a APAGAR TODAS AS ${total} ${total === 1 ? 'INSCRI√á√ÉO' : 'INSCRI√á√ïES'}!\n\nEsta a√ß√£o n√£o pode ser desfeita!`)) {
                return;
              }
              
              const confirmText = prompt('Para confirmar, digite CONFIRMAR em mai√∫sculas:');
              if (confirmText !== 'CONFIRMAR') {
                alert('‚ùå Opera√ß√£o cancelada!');
                return;
              }
              
              try{
                const r = await fetch('/api/admin/inscricoes/clear', { method: 'POST', credentials: 'include' });
                if (!r.ok) throw new Error('Falha ao limpar as inscri√ß√µes');
                alert(`‚úÖ ${total} ${total === 1 ? 'inscri√ß√£o foi' : 'inscri√ß√µes foram'} removida(s) com sucesso`);
                try { 
                  const data = await fetchJson('/api/admin/inscricoes'); 
                  renderInscricoes(data); 
                } catch(e) { 
                  console.error('Erro ao recarregar:', e);
                }
              }catch(e){ 
                alert('‚ùå Erro: ' + e.message); 
              }
            });
          }
        }, 100);

        // Bot√µes de excluir (apenas para desktop - mobile usa eventos em renderCards)
        setTimeout(() => {
          document.querySelectorAll('.delIns').forEach(btn => {
            // Verifica se √© em uma tabela (desktop) ou em cards (mobile)
            const isInTable = btn.closest('table') !== null;
            if (!isInTable) return; // Pula se estiver em cards mobile
            
            btn.addEventListener('click', async (e) => {
              const idx = Number(e.currentTarget.getAttribute('data-idx'));
              const row = e.currentTarget.closest('tr');
              let nome = '';
              if (row) {
                nome = row.querySelector('td:nth-child(2) pre') ? row.querySelector('td:nth-child(2) pre').textContent : '';
              }

              if (!confirm(`‚ö†Ô∏è ATEN√á√ÉO!\n\nVoc√™ est√° prestes a EXCLUIR esta inscri√ß√£o:\n${nome}\n\nEsta a√ß√£o n√£o pode ser desfeita. Deseja continuar?`)) {
                alert('‚ùå Opera√ß√£o cancelada!');
                return;
              }

              const confirmText = prompt('‚ö†Ô∏è √öltima chance!\n\nPara confirmar a exclus√£o, digite CONFIRMAR (mai√∫sculas):');
              const userInput = (confirmText || '').trim().toUpperCase();
              if (userInput !== 'CONFIRMAR') {
                alert('‚ùå Opera√ß√£o cancelada! Texto n√£o corresponde a "CONFIRMAR".');
                return;
              }

              try {
                const r = await fetch('/api/admin/inscricoes/delete', {
                  method: 'POST',
                  credentials: 'include',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ index: idx })
                });
                if (!r.ok) {
                  let details = '';
                  try { const data = await r.json(); details = data && (data.error || JSON.stringify(data)); } catch(e) { try { details = await r.text(); } catch(_) { details = ''; } }
                  console.error('Erro ao excluir inscri√ß√£o', r.status, details);
                  if (r.status === 401) throw new Error('N√£o autorizado. Fa√ßa login novamente.');
                  throw new Error((details && details.toString()) || ('Status ' + r.status));
                }
                alert('‚úÖ Inscri√ß√£o exclu√≠da com sucesso');
                try { 
                  const data = await fetchJson('/api/admin/inscricoes'); 
                  renderInscricoes(data); 
                } catch(e) { 
                  console.error('Erro ao recarregar:', e);
                }
              } catch (err) {
                console.error(err);
                alert('‚ùå Erro ao excluir inscri√ß√£o!\n\n' + err.message + '\n\nVerifique o console do servidor para mais detalhes.');
              }
            });
          });
        }, 100);

        // Preview inscription data in a modal and offer download
        function showInscricaoPreview(obj) {
          // Create and show modal with preview
          const modal = document.createElement('div');
          modal.className = 'modal-overlay active';
          
          const title = (obj.nome || 'Inscri√ß√£o').toString();
          let html = `
            <div class="modal-content">
              <div class="modal-header">
                <div style="flex:1">
                  <h2 style="margin:0;font-size:1.3rem;font-weight:700;letter-spacing:0.5px">üìã INSCRI√á√ÉO</h2>
                  <p style="margin:0.5rem 0 0 0;font-size:0.95rem;opacity:0.95">${title.toUpperCase()}</p>
                </div>
                <button class="btn-close">&times;</button>
              </div>
              <div class="modal-body">
                <table class="preview-table">
                  <thead style="display:none"></thead>
                  <tbody>`;
          
          // DEBUG: Log de todos os campos do objeto
          console.log('Objeto de inscri√ß√£o:', obj);
          console.log('Chaves dispon√≠veis:', Object.keys(obj));
          
          // Ordem espec√≠fica dos campos (com m√∫ltiplas varia√ß√µes de nomes)
          const fieldOrder = [
            { key: 'nome', label: 'NOME' },
            { key: 'idade', label: 'IDADE' },
            { key: 'tipo_participacao', label: 'PARTICIPA√á√ïES' },
            { key: 'telefone', label: 'TELEFONE' },
            { key: 'endereco', label: 'ENDERE√áO' },
            { key: 'bairro', label: 'BAIRRO' },
            { keys: ['rede_sociais', 'Rede_sociais', 'rede sociais'], label: 'REDE SOCIAIS' },
            { key: 'email', label: 'EMAIL' },
            { key: 'receivedAt', label: 'DATA/HORA' }
          ];
          const processedKeys = new Set();
          
          // Mostrar campos na ordem espec√≠fica
          fieldOrder.forEach(fieldInfo => {
            let key = null;
            let value = null;
            
            if (fieldInfo.key) {
              if (obj.hasOwnProperty(fieldInfo.key)) {
                key = fieldInfo.key;
                value = obj[key];
              }
            } else if (fieldInfo.keys) {
              // Procurar por v√°rias varia√ß√µes de nome
              for (let variant of fieldInfo.keys) {
                if (obj.hasOwnProperty(variant)) {
                  key = variant;
                  value = obj[variant];
                  break;
                }
              }
            }
            
            if (key !== null) {
              processedKeys.add(key);
              
              if (typeof value === 'object') value = JSON.stringify(value, null, 2);
              
              if (key === 'receivedAt') {
                value = new Date(Number(value)).toLocaleString().toUpperCase();
              } else if (typeof value === 'string') {
                value = value.toUpperCase();
              }
              
              html += `<tr><th>${fieldInfo.label}</th><td>${String(value || '').toUpperCase() || 'N/A'}</td></tr>`;
            }
          });
          
          // Mostrar campos restantes (n√£o definidos na ordem)
          Object.keys(obj).forEach(k => {
            if (processedKeys.has(k) || k === '_origIndex' || k === 'ip' || k === 'deviceId' || k === 'DEVICEID') return;
            
            let v = obj[k];
            if (typeof v === 'object') v = JSON.stringify(v, null, 2);
            
            let label = k.toUpperCase();
            if (typeof v === 'string') {
              v = v.toUpperCase();
            }
            
            html += `<tr><th>${label}</th><td>${String(v || '').toUpperCase()}</td></tr>`;
          });

          html += `
                  </tbody>
                </table>
              </div>
              <div class="modal-actions">
                <button class="btn-download btn-cancel">‚úì FECHAR</button>
              </div>
            </div>`;

          modal.innerHTML = html;
          document.body.appendChild(modal);

          // Handle close via X button or backdrop click
          const close = () => {
            modal.remove();
          };

          modal.querySelector('.btn-close').addEventListener('click', close);
          modal.querySelector('.btn-cancel').addEventListener('click', close);
          modal.addEventListener('click', e => {
            if (e.target === modal) close();
          });
        }

        // Attach handlers for Ver buttons (show preview modal first)
        function attachVerHandlers(insArray) {
          document.querySelectorAll('.verIns').forEach(btn => btn.addEventListener('click', (e)=>{
            const idx = Number(btn.getAttribute('data-idx'));
            const obj = insArray[idx];
            if (!obj) return alert('Registro n√£o encontrado');
            showInscricaoPreview(obj);
          }));
        }
      }

      function renderContatos(arr){
        if (!Array.isArray(arr) || arr.length === 0) {
          contentEl.innerHTML = `<div class="card">
            <h2 class="section-title">üìß Contatos</h2>
            <p style="color:#999;text-align:center;padding:2rem 0">Nenhum contato registrado no momento.</p>
          </div>`;
          return;
        }
        
        // An√°lise dos contatos
        const assuntos = {};
        arr.forEach(c => {
          const ass = c.assunto || c.subject || 'Sem assunto';
          assuntos[ass] = (assuntos[ass] || 0) + 1;
        });

        let html = `<div class="card" style="border:3px solid #ff8a00;background:linear-gradient(135deg, rgb(0 0 0 / 54%) 0%, rgba(0, 70, 173, 0.02) 100%);box-shadow:0 0 20px rgba(255,138,0,0.15), 0 8px 24px rgba(0,0,0,0.1)">
          <div style="display:flex;align-items:center;justify-content:center;flex-direction:column;margin-bottom:1rem;gap:1rem;padding-bottom:1rem;border-bottom:2px solid #ff8a00">
            <div style="width:100%;text-align:center">
              <h2 class="section-title" style="font-family:'Ducks Fiesta','Poppins','Trebuchet MS','Gill Sans',sans-serif;color:#ff8a00;font-size:1.8rem;font-weight:900;letter-spacing:1.5px;text-shadow:0 2px 8px rgba(0,0,0,0.15);text-transform:uppercase;margin:0">üìß Contatos</h2>
              <p class="section-stats">${arr.length} ${arr.length === 1 ? 'contato' : 'contatos'} registrado${arr.length === 1 ? '' : 's'}</p>
            </div>
            <button id="clearContBtn" class="btn-delete" style="padding:0.6rem 1rem;width:100%">
              üóëÔ∏è Limpar todos
            </button>
          </div>
          
          <div class="search-filter">
            <input type="text" id="searchContatos" class="search-input" placeholder="üîç Buscar contatos por nome, email ou telefone...">
          </div>
          
          <div class="cards-grid" id="contatosGrid"></div>
        </div>`;
        
        contentEl.innerHTML = html;
        const grid = document.getElementById('contatosGrid');
        const searchInput = document.getElementById('searchContatos');
        
        function renderCards(items) {
          if (items.length === 0) {
            grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:2rem;color:#999">Nenhum resultado encontrado</div>';
            return;
          }
          
          grid.innerHTML = items.map((item, filteredIdx) => {
            // Encontra o √≠ndice original no array completo
            const originalIdx = arr.findIndex(orig => orig === item);
            const nome = item.nome || item.name || 'Sem nome';
            const email = item.email || '-';
            const telefone = item.telefone || item.phone || item.whatsapp || '-';
            const assunto = item.assunto || item.subject || '-';
            const dataCriacao = item.receivedAt ? new Date(Number(item.receivedAt)).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' }) : '-';
            const mensagem = item.mensagem || item.message || '';
            const resumoMsg = mensagem.length > 100 ? mensagem.substring(0, 100) + '...' : mensagem;
            
            return `
              <div class="data-card contact">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0.75rem;padding-bottom:0.75rem;border-bottom:2px solid #00b37a">
                  <div style="font-weight:600;font-size:1.05rem;color:#333">${nome}</div>
                  <div style="background:#e8f5f0;color:#00b37a;padding:0.25rem 0.75rem;border-radius:4px;font-size:0.8rem;font-weight:500">${dataCriacao}</div>
                </div>
                <div class="card-field">
                  <div class="card-field-label">üìå Assunto</div>
                  <div class="card-field-value" style="font-weight:500;color:#0b3a91">${assunto}</div>
                </div>
                <div class="card-field">
                  <div class="card-field-label">üìß Email</div>
                  <div class="card-field-value"><a href="mailto:${email}" style="color:#00b37a;text-decoration:none;word-break:break-all">${email}</a></div>
                </div>
                <div class="card-field">
                  <div class="card-field-label">üì± Telefone</div>
                  <div class="card-field-value"><a href="tel:${telefone}" style="color:#0b3a91;text-decoration:none">${telefone}</a></div>
                </div>
                ${resumoMsg ? `<div class="card-field">
                  <div class="card-field-label">üí¨ Mensagem</div>
                  <div class="card-field-value" style="font-size:0.9rem;color:#666;line-height:1.4;max-height:80px;overflow-y:auto">${resumoMsg}</div>
                </div>` : ''}
                <div class="card-actions">
                  <button data-idx="${originalIdx}" class="verCont" style="flex:1;background:#0b5cff">Ver Completo</button>
                  <button data-idx="${originalIdx}" class="delCont" style="flex:1;background:#dc2626">üóëÔ∏è Excluir</button>
                </div>
              </div>
            `;
          }).join('');
          
          // Reattach event handlers
          document.querySelectorAll('.verCont').forEach(btn => btn.addEventListener('click', viewContato));
          document.querySelectorAll('.delCont').forEach(btn => btn.addEventListener('click', deleteContato));
        }
        
        function viewContato(e) {
          const idx = Number(e.currentTarget.getAttribute('data-idx'));
          const item = arr[idx];
          if (!item) return alert('Contato n√£o encontrado');
          
          const nome = item.nome || item.name || 'Sem nome';
          const email = item.email || '';
          const telefone = item.telefone || item.phone || item.whatsapp || '';
          const assunto = item.assunto || item.subject || '';
          const mensagem = item.mensagem || item.message || '';
          const dataCriacao = item.receivedAt ? new Date(Number(item.receivedAt)).toLocaleString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          }) : '-';
          
          // Modal para impress√£o em formato A4
          const modal = document.createElement('div');
          modal.className = 'modal-overlay';
          modal.innerHTML = `
            <div class="modal-content" style="max-width:900px;background:#fff">
              <div class="modal-header">
                <h2 style="margin:0;font-size:1.3rem">üìß DETALHES DO CONTATO</h2>
                <button class="btn-close">&times;</button>
              </div>
              <div class="modal-body">
                <div style="background:#f5f5f5;padding:2rem;border-radius:8px;font-family:'Courier New',monospace">
                  <div style="display:grid;gap:1.5rem;min-height:500px">
                    <div style="border-bottom:2px solid #00b37a;padding-bottom:1rem">
                      <h3 style="margin:0 0 0.5rem 0;color:#00b37a;font-size:0.9rem;text-transform:uppercase;letter-spacing:1px">üë§ Nome</h3>
                      <div style="font-size:1.3rem;font-weight:bold;color:#333">${nome}</div>
                    </div>
                    
                    <div style="border-bottom:2px solid #00b37a;padding-bottom:1rem">
                      <h3 style="margin:0 0 0.5rem 0;color:#00b37a;font-size:0.9rem;text-transform:uppercase;letter-spacing:1px">üìß Email</h3>
                      <div style="font-size:1rem;color:#0b5cff;word-break:break-all">${email}</div>
                    </div>
                    
                    <div style="border-bottom:2px solid #00b37a;padding-bottom:1rem">
                      <h3 style="margin:0 0 0.5rem 0;color:#00b37a;font-size:0.9rem;text-transform:uppercase;letter-spacing:1px">üì± Telefone</h3>
                      <div style="font-size:1.1rem;color:#333">${telefone}</div>
                    </div>
                    
                    <div style="border-bottom:2px solid #00b37a;padding-bottom:1rem">
                      <h3 style="margin:0 0 0.5rem 0;color:#00b37a;font-size:0.9rem;text-transform:uppercase;letter-spacing:1px">üìå Assunto</h3>
                      <div style="font-size:1rem;color:#333;font-weight:500">${assunto}</div>
                    </div>
                    
                    <div style="border-bottom:2px solid #00b37a;padding-bottom:1rem">
                      <h3 style="margin:0 0 0.5rem 0;color:#00b37a;font-size:0.9rem;text-transform:uppercase;letter-spacing:1px">üïê Data de Recebimento</h3>
                      <div style="font-size:0.95rem;color:#666">${dataCriacao}</div>
                    </div>
                    
                    <div style="padding-bottom:1rem;flex:1;display:flex;flex-direction:column">
                      <h3 style="margin:0 0 0.5rem 0;color:#00b37a;font-size:0.9rem;text-transform:uppercase;letter-spacing:1px">üí¨ Mensagem Completa</h3>
                      <div style="font-size:0.95rem;color:#333;line-height:1.6;white-space:pre-wrap;word-break:break-word;flex:1;background:#fff;padding:1rem;border-radius:6px;border:1px solid #ddd">${mensagem}</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="modal-actions">
                <button style="background:#0b5cff;color:#fff;border:none;padding:0.6rem 1.5rem;border-radius:6px;cursor:pointer" onclick="window.print()">üñ®Ô∏è Imprimir</button>
                <button style="background:#00b37a;color:#fff;border:none;padding:0.6rem 1.5rem;border-radius:6px;cursor:pointer" onclick="window.open('mailto:${email}')">‚úâÔ∏è Responder</button>
                <button class="btn-cancel">Fechar</button>
              </div>
            </div>
          `;
          
          document.body.appendChild(modal);
          
          const close = () => modal.remove();
          modal.querySelector('.btn-close').addEventListener('click', close);
          modal.querySelector('.btn-cancel').addEventListener('click', close);
          modal.addEventListener('click', e => {
            if (e.target === modal) close();
          });
          
          // Estilos de impress√£o
          const style = document.createElement('style');
          style.innerHTML = `
            @media print {
              body * { display: none; }
              .modal-overlay * { display: block !important; }
              .modal-content { box-shadow: none; width: 100%; max-width: 100%; }
              .modal-header, .modal-actions { display: none; }
              .modal-body { padding: 0; }
            }
          `;
          document.head.appendChild(style);
        }
        
        renderCards(arr);
        
        searchInput.addEventListener('input', (e) => {
          const term = e.target.value.toLowerCase();
          const filtered = arr.filter(item => {
            const nome = (item.nome || item.name || '').toLowerCase();
            const email = (item.email || '').toLowerCase();
            const telefone = (item.telefone || item.phone || item.whatsapp || '').toLowerCase();
            return nome.includes(term) || email.includes(term) || telefone.includes(term);
          });
          renderCards(filtered);
        });
        
        async function deleteContato(e) {
          const idx = Number(e.currentTarget.getAttribute('data-idx'));
          const nome = arr[idx].nome || arr[idx].name || 'Contato';
          
          if (!confirm(`‚ö†Ô∏è Deseja excluir o contato de ${nome}?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
            return;
          }
          
          try {
            const r = await fetch('/api/admin/contatos/delete', {
              method: 'POST',
              credentials: 'include',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ index: idx })
            });
            
            if (!r.ok) {
              const errData = await r.json().catch(() => ({ error: 'Erro ao deletar' }));
              throw new Error(errData.error || `Erro ${r.status}`);
            }
            
            alert('‚úÖ Contato exclu√≠do com sucesso');
            // Recarregar contatos
            try { 
              const data = await fetchJson('/api/admin/contatos'); 
              renderContatos(data); 
            } catch(e) { 
              console.error('Erro ao recarregar:', e);
            }
          } catch (err) {
            console.error('Erro ao deletar contato:', err);
            alert('‚ùå Erro: ' + err.message);
          }
        }
        
        document.getElementById('clearContBtn').addEventListener('click', async ()=>{
          const total = arr.length;
          if (!confirm(`‚ö†Ô∏è ATEN√á√ÉO!\n\nVoc√™ est√° prestes a APAGAR TODOS OS ${total} ${total === 1 ? 'CONTATO' : 'CONTATOS'}!\n\nEsta a√ß√£o n√£o pode ser desfeita!`)) {
            return;
          }
          
          const confirmText = prompt('Para confirmar, digite CONFIRMAR em mai√∫sculas:');
          if (confirmText !== 'CONFIRMAR') {
            alert('‚ùå Opera√ß√£o cancelada!');
            return;
          }
          
          try{
            const r = await fetch('/api/admin/contatos/clear', { method: 'POST', credentials: 'include' });
            if (!r.ok) throw new Error('Falha ao limpar os contatos');
            alert(`‚úÖ ${total} ${total === 1 ? 'contato foi' : 'contatos foram'} removido(s) com sucesso`);
            try { 
              const data = await fetchJson('/api/admin/contatos'); 
              renderContatos(data); 
            } catch(e) { 
              console.error('Erro ao recarregar:', e);
            }
          }catch(e){ 
            alert('‚ùå Erro: ' + e.message); 
          }
        });
      }

      function renderContratacoes(arr){
        if (!Array.isArray(arr) || arr.length === 0) {
          contentEl.innerHTML = `<div class="card">
            <h2 class="section-title">üé≠ Contrata√ß√µes</h2>
            <p style="color:#999;text-align:center;padding:2rem 0">Nenhuma contrata√ß√£o registrada no momento.</p>
          </div>`;
          return;
        }
        
        let html = `<div class="card" style="border:3px solid #ff8a00;background:linear-gradient(135deg, rgb(0 0 0 / 54%) 0%, rgba(0, 70, 173, 0.02) 100%);box-shadow:0 0 20px rgba(255,138,0,0.15), 0 8px 24px rgba(0,0,0,0.1)">
          <div style="display:flex;align-items:center;justify-content:center;flex-direction:column;margin-bottom:1rem;gap:1rem;padding-bottom:1rem;border-bottom:2px solid #ff8a00">
            <div style="width:100%;text-align:center">
              <h2 class="section-title" style="font-family:'Ducks Fiesta','Poppins','Trebuchet MS','Gill Sans',sans-serif;color:#ff8a00;font-size:1.8rem;font-weight:900;letter-spacing:1.5px;text-shadow:0 2px 8px rgba(0,0,0,0.15);text-transform:uppercase;margin:0">üé≠ Contrata√ß√µes</h2>
              <p class="section-stats">${arr.length} contrata${arr.length === 1 ? '√ß√£o' : '√ß√µes'} registrada${arr.length === 1 ? '' : 's'}</p>
            </div>
            <button id="clearConrBtn" class="btn-delete" style="padding:0.6rem 1rem;width:100%">
              üóëÔ∏è Limpar todos
            </button>
          </div>
          
          <div class="search-filter">
            <input type="text" id="searchContratacoes" class="search-input" placeholder="üîç Buscar por artista, grupo ou tipo de servi√ßo...">
          </div>
          
          <div class="cards-grid" id="contratcoesGrid"></div>
        </div>`;
        
        contentEl.innerHTML = html;
        const grid = document.getElementById('contratcoesGrid');
        const searchInput = document.getElementById('searchContratacoes');
        
        function renderCards(items) {
          if (items.length === 0) {
            grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:2rem;color:#999">Nenhum resultado encontrado</div>';
            return;
          }
          
          grid.innerHTML = items.map((item, filteredIdx) => {
            // Encontra o √≠ndice original no array completo
            const originalIdx = arr.findIndex(orig => orig === item);
            const nomeContratante = item.nomeContratante || item.nome || '-';
            const emailContratante = item.emailContratante || item.email || '-';
            const telefoneContratante = item.telefoneContratante || item.telefone || '-';
            const dataEvento = item.dataEvento || item.data || '-';
            const localEvento = item.localEvento || item.local || '-';
            const detalhesEvento = item.detalhesEvento || item.detalhes || '-';
            const dataCriacao = item.receivedAt ? new Date(Number(item.receivedAt)).toLocaleDateString('pt-BR') : '-';
            
            return `
              <div class="data-card contractor">
                <div class="card-field">
                  <div class="card-field-label">üë§ Nome do Contratante</div>
                  <div class="card-field-value">${nomeContratante}</div>
                </div>
                <div class="card-field">
                  <div class="card-field-label">üìß E-mail</div>
                  <div class="card-field-value"><a href="mailto:${emailContratante}" style="color:#ff7a00;text-decoration:none">${emailContratante}</a></div>
                </div>
                <div class="card-field">
                  <div class="card-field-label">üì± Telefone</div>
                  <div class="card-field-value"><a href="tel:${telefoneContratante}" style="color:#ff7a00;text-decoration:none">${telefoneContratante}</a></div>
                </div>
                <div class="card-field">
                  <div class="card-field-label">üìÖ Data do Evento</div>
                  <div class="card-field-value">${dataEvento}</div>
                </div>
                <div class="card-field">
                  <div class="card-field-label">üìç Local do Evento</div>
                  <div class="card-field-value">${localEvento}</div>
                </div>
                <div class="card-field">
                  <div class="card-field-label">üìù Detalhes do Evento</div>
                  <div class="card-field-value" style="max-height:120px;overflow-y:auto">${detalhesEvento}</div>
                </div>
                <div class="card-field">
                  <div class="card-field-label">üïê Registrado em</div>
                  <div class="card-field-value">${dataCriacao}</div>
                </div>
                <div class="card-actions">
                  <button data-idx="${originalIdx}" class="verContr" style="flex:1;background:#ff7a00">Ver</button>
                  <button data-idx="${originalIdx}" class="delContr" style="flex:1;background:#dc2626">üóëÔ∏è Excluir</button>
                </div>
              </div>
            `;
          }).join('');
          
          // Reattach delete handlers and view handlers
          document.querySelectorAll('.delContr').forEach(btn => btn.addEventListener('click', deleteContratacao));
          document.querySelectorAll('.verContr').forEach(btn => btn.addEventListener('click', viewContratacao));
        }
        
        renderCards(arr);
        
        searchInput.addEventListener('input', (e) => {
          const term = e.target.value.toLowerCase();
          const filtered = arr.filter(item => {
            const nomeContratante = (item.nomeContratante || item.nome || '').toLowerCase();
            const emailContratante = (item.emailContratante || item.email || '').toLowerCase();
            const telefoneContratante = (item.telefoneContratante || item.telefone || '').toLowerCase();
            const dataEvento = (item.dataEvento || item.data || '').toLowerCase();
            const localEvento = (item.localEvento || item.local || '').toLowerCase();
            return nomeContratante.includes(term) || emailContratante.includes(term) || telefoneContratante.includes(term) || dataEvento.includes(term) || localEvento.includes(term);
          });
          renderCards(filtered);
        });
        
        // Bot√£o de limpar todas as contrata√ß√µes
        const clearConrBtn = document.getElementById('clearConrBtn');
        console.log('[CONTRATA√á√ïES CARDS] clearConrBtn:', clearConrBtn);
        if (clearConrBtn) {
          clearConrBtn.addEventListener('click', async ()=>{
            const total = arr.length;
            if (!confirm(`‚ö†Ô∏è ATEN√á√ÉO!\n\nVoc√™ est√° prestes a APAGAR TODAS AS ${total} ${total === 1 ? 'CONTRATA√á√ÉO' : 'CONTRATA√á√ïES'}!\n\nEsta a√ß√£o n√£o pode ser desfeita!`)) {
              return;
            }
            
            const confirmText = prompt('Para confirmar, digite CONFIRMAR em mai√∫sculas:');
            if (confirmText !== 'CONFIRMAR') {
              alert('‚ùå Opera√ß√£o cancelada!');
              return;
            }
            
            try{
              const r = await fetch('/api/admin/contratacoes/clear', { method: 'POST', credentials: 'include' });
              if (!r.ok) throw new Error('Falha ao limpar as contrata√ß√µes');
              alert(`‚úÖ ${total} ${total === 1 ? 'contrata√ß√£o foi' : 'contrata√ß√µes foram'} removida(s) com sucesso`);
              try { 
                const data = await fetchJson('/api/admin/contratacoes'); 
                renderContratacoes(data); 
              } catch(e) { 
                console.error('Erro ao recarregar:', e);
              }
            }catch(e){ 
              alert('‚ùå Erro: ' + e.message); 
            }
          });
        }
        
        
        async function viewContratacao(e) {
          const idx = Number(e.currentTarget.getAttribute('data-idx'));
          const item = arr[idx];
          const nomeContratante = item.nomeContratante || item.nome || '-';
          const emailContratante = item.emailContratante || item.email || '-';
          const telefoneContratante = item.telefoneContratante || item.telefone || '-';
          const dataEvento = item.dataEvento || item.data || '-';
          const localEvento = item.localEvento || item.local || '-';
          const detalhesEvento = item.detalhesEvento || item.detalhes || '-';
          const dataCriacao = item.receivedAt ? new Date(Number(item.receivedAt)).toLocaleDateString('pt-BR') : '-';
          
          const printWindow = window.open('', '', 'height=800,width=600');
          const doc = printWindow.document;
          doc.write('<!DOCTYPE html><html><head><meta charset="UTF-8">');
          doc.write('<title>Solicitacao de Contratacao</title>');
          doc.write('<style>body{font-family:Arial;margin:0;padding:20px}');
          doc.write('.container{max-width:210mm;height:297mm;margin:0 auto;padding:20mm;background:white}');
          doc.write('h1{text-align:center;color:#ff7a00;border-bottom:3px solid #ff7a00;padding-bottom:10px}');
          doc.write('.field{margin:15px 0}.field-label{font-weight:bold;color:#333;font-size:12px}');
          doc.write('.field-value{color:#666;font-size:13px;padding:8px;background:#f5f5f5;border-left:3px solid #ff7a00;padding-left:10px}');
          doc.write('.print-button{text-align:center;margin:20px 0}');
          doc.write('.print-button button{padding:10px 20px;background:#ff7a00;color:white;border:none;border-radius:5px;cursor:pointer;font-size:16px}');
          doc.write('.print-button button:hover{background:#e67e00}');
          doc.write('@media print{body{margin:0;padding:0}.container{box-shadow:none;height:auto}.print-button{display:none}}');
          doc.write('</style></head><body><div class="container">');
          doc.write('<h1>Solicitacao de Contratacao</h1>');
          doc.write('<div class="field"><div class="field-label">Nome do Contratante</div><div class="field-value">' + nomeContratante + '</div></div>');
          doc.write('<div class="field"><div class="field-label">Email</div><div class="field-value">' + emailContratante + '</div></div>');
          doc.write('<div class="field"><div class="field-label">Telefone</div><div class="field-value">' + telefoneContratante + '</div></div>');
          doc.write('<div class="field"><div class="field-label">Data do Evento</div><div class="field-value">' + dataEvento + '</div></div>');
          doc.write('<div class="field"><div class="field-label">Local do Evento</div><div class="field-value">' + localEvento + '</div></div>');
          doc.write('<div class="field"><div class="field-label">Detalhes do Evento</div><div class="field-value">' + detalhesEvento.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div></div>');
          doc.write('<div class="field"><div class="field-label">Registrado em</div><div class="field-value">' + dataCriacao + '</div></div>');
          doc.write('<div class="print-button"><button onclick="window.print()">Imprimir</button></div>');
          doc.write('</div></body></html>');
          doc.close();
        }
        
        async function deleteContratacao(e) {
          const idx = Number(e.currentTarget.getAttribute('data-idx'));
          const nomeContratante = arr[idx].nomeContratante || arr[idx].nome || 'Contrata√ß√£o';
          
          if (!confirm(`‚ö†Ô∏è Deseja excluir a contrata√ß√£o de ${nomeContratante}?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
            return;
          }
          
          try {
            const r = await fetch('/api/admin/contratacoes/delete', {
              method: 'DELETE',
              credentials: 'include',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ index: idx })
            });
            
            if (!r.ok) {
              const errData = await r.json().catch(() => ({ error: 'Erro ao deletar' }));
              throw new Error(errData.error || `Erro ${r.status}`);
            }
            
            alert('‚úÖ Contrata√ß√£o exclu√≠da com sucesso');
            // Recarregar contrata√ß√µes
            try { 
              const data = await fetchJson('/api/admin/contratacoes'); 
              renderContratacoes(data); 
            } catch(e) { 
              console.error('Erro ao recarregar:', e);
            }
          } catch (err) {
            console.error('Erro ao deletar contrata√ß√£o:', err);
            alert('‚ùå Erro: ' + err.message);
          }
        }
      }

    // Bot√£o de limpar contatos
    const btnClearCttEl = document.getElementById('btnClearCtt');
    if (btnClearCttEl) btnClearCttEl.addEventListener('click', async ()=> {
      try {
        const data = await fetchJson('/api/admin/contatos');
        if (!Array.isArray(data) || data.length === 0) {
          alert('‚ÑπÔ∏è N√£o h√° contatos para limpar.');
          return;
        }

        const total = data.length;
        
        // Primeiro alerta com detalhes da opera√ß√£o
        const msg = `‚ö†Ô∏è ATEN√á√ÉO! Opera√ß√£o Destrutiva!\n\n`
          + `Voc√™ est√° prestes a APAGAR TODOS OS ${total} ${total === 1 ? 'CONTATO' : 'CONTATOS'}!\n\n`
          + `Esta a√ß√£o:\n`
          + `- N√£o pode ser desfeita\n`
          + `- Apagar√° PERMANENTEMENTE todos os contatos\n`
          + `- N√£o h√° backup autom√°tico\n\n`
          + `Quantidade de registros: ${total}\n\n`
          + `Tem certeza absoluta que deseja continuar?`;
        
        if (!confirm(msg)) {
          alert('‚ùå Opera√ß√£o cancelada!\nNenhum contato foi removido.');
          return;
        }
        
        // Solicita digita√ß√£o de CONFIRMAR
        const confirmText = prompt(
          '‚ö†Ô∏è √öltima chance!\n\n'
          + 'Para confirmar a exclus√£o, digite CONFIRMAR\n'
          + '(exatamente como mostrado, em mai√∫sculas):'
        );
        
        // Remove espa√ßos e verifica se digitou exatamente CONFIRMAR
        const userInput = (confirmText || '').trim().toUpperCase();
        if (userInput !== 'CONFIRMAR') {
          alert('‚ùå Opera√ß√£o cancelada!\nNenhum contato foi removido.\n\n'
            + 'Motivo: O texto digitado n√£o corresponde a "CONFIRMAR".');
          return;
        }

        // Se chegou aqui, executa a limpeza
        const r = await fetch('/api/admin/contatos/clear', { 
          method: 'POST', 
          credentials: 'include' 
        });
        if (!r.ok) throw new Error('Falha ao limpar os contatos');
        alert(`‚úÖ Sucesso!\n\n${total} ${total === 1 ? 'contato foi removido' : 'contatos foram removidos'} com sucesso.`);
        try { 
          const data = await fetchJson('/api/admin/contatos'); 
          renderContatos(data); 
        } catch(e) { 
          console.error('Erro ao recarregar:', e);
        }
      } catch(e) { 
        alert('‚ùå Erro ao limpar contatos!\n\n' + e.message + '\n\nNenhum contato foi removido.'); 
      }
    });

    // auto-load inscriptions on open
    (async ()=>{ try{ const data = await fetchJson('/api/admin/inscricoes'); renderInscricoes(data);}catch(e){ /* ignore */ } })();

    // ===== TEMA CLARO/ESCURO =====
    const themeToggle = document.getElementById('themeToggle');
    const themeSwitch = document.getElementById('themeSwitch');
    const themeLabelText = document.getElementById('themeLabelText');
    const htmlEl = document.documentElement;
    
    // Carregar tema salvo no localStorage
    function loadTheme() {
      const savedTheme = localStorage.getItem('admin-theme') || 'dark';
      if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
        updateThemeButton();
      } else {
        document.body.classList.remove('light-mode');
        updateThemeButton();
      }
    }
    
    function updateThemeButton() {
      if (document.body.classList.contains('light-mode')) {
        // Tema claro ativo = OFF (cinza mais claro)
        themeToggle.classList.remove('active');
        themeLabelText.textContent = '‚òÄÔ∏è Tema Claro';
      } else {
        // Tema escuro ativo = ON (cinza mais escuro)
        themeToggle.classList.add('active');
        themeLabelText.textContent = 'üåô Tema Escuro';
      }
    }
    
    // Toggle de tema
    if (themeToggle) {
      themeToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        document.body.classList.toggle('light-mode');
        const isLight = document.body.classList.contains('light-mode');
        localStorage.setItem('admin-theme', isLight ? 'light' : 'dark');
        updateThemeButton();
      });
    }
    
    // Fechar menu ao clicar no switch
    if (themeSwitch) {
      themeSwitch.addEventListener('click', () => {
        sidebar.classList.remove('active');
        menuOverlay.classList.remove('active');
        menuToggle.classList.remove('active');
      });
    }
    
    // Carregar tema ao iniciar
    loadTheme();

    // ===== BOT√ïES DE DESKTOP =====
    const btnInsEl = document.getElementById('btnIns');
    if (btnInsEl) btnInsEl.addEventListener('click', async ()=> {
      try{ const data = await fetchJson('/api/admin/inscricoes'); renderInscricoes(data); }
      catch(e){ alert('‚ùå Erro ao carregar inscri√ß√µes: ' + e.message); }
    });

    const btnContEl = document.getElementById('btnCont');
    if (btnContEl) btnContEl.addEventListener('click', async ()=> {
      try{ const data = await fetchJson('/api/admin/contatos'); renderContatos(data); }
      catch(e){ alert('‚ùå Erro ao carregar contatos: ' + e.message); }
    });

    const btnConrEl = document.getElementById('btnConr');
    if (btnConrEl) btnConrEl.addEventListener('click', async ()=> {
      try{ const data = await fetchJson('/api/admin/contratacoes'); renderContratacoes(data); }
      catch(e){ alert('‚ùå Erro ao carregar contrata√ß√µes: ' + e.message); }
    });

    // Bot√£o de Sair (Desktop)
    const btnLogoutEl = document.getElementById('btnLogout');
    if (btnLogoutEl) btnLogoutEl.addEventListener('click', ()=> {
      document.getElementById('logoutModal').classList.add('active');
    });

    // ===== MENU HAMBURGER LOGIC (MOBILE/TABLET) =====
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const menuOverlay = document.getElementById('menuOverlay');
    const navItems = document.querySelectorAll('.nav-item');

    // Toggle menu
    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('active');
      menuOverlay.classList.toggle('active');
      menuToggle.classList.toggle('active');
    });

    // Fechar menu ao clicar no overlay
    menuOverlay.addEventListener('click', () => {
      sidebar.classList.remove('active');
      menuOverlay.classList.remove('active');
      menuToggle.classList.remove('active');
    });

    // Fechar menu ao clicar em um item
    navItems.forEach(item => {
      item.addEventListener('click', () => {
        sidebar.classList.remove('active');
        menuOverlay.classList.remove('active');
        menuToggle.classList.remove('active');
      });
    });

    // A√ß√µes dos itens do menu mobile
    document.getElementById('navInscri√ß√µes').addEventListener('click', async () => {
      try { 
        const data = await fetchJson('/api/admin/inscricoes'); 
        renderInscricoes(data); 
      } catch(e) { 
        alert('‚ùå Erro ao carregar inscri√ß√µes: ' + e.message); 
      }
    });

    document.getElementById('navContatos').addEventListener('click', async () => {
      try { 
        const data = await fetchJson('/api/admin/contatos'); 
        renderContatos(data); 
      } catch(e) { 
        alert('‚ùå Erro ao carregar contatos: ' + e.message); 
      }
    });

    document.getElementById('navContratacoes').addEventListener('click', async () => {
      try { 
        const data = await fetchJson('/api/admin/contratacoes'); 
        renderContratacoes(data); 
      } catch(e) { 
        alert('‚ùå Erro ao carregar contrata√ß√µes: ' + e.message); 
      }
    });

    // Menu items - Ir para o Site e Sair
    document.getElementById('navHome').addEventListener('click', () => {
      // Fechar menu antes de navegar
      sidebar.classList.remove('active');
      menuOverlay.classList.remove('active');
      menuToggle.classList.remove('active');
      window.location.href = 'index.html';
    });

    // Aguardar que os elementos do modal sejam criados antes de adicionar listeners
    setTimeout(() => {
      const logoutCancelBtn = document.getElementById('logoutCancel');
      const logoutConfirmBtn = document.getElementById('logoutConfirm');
      const logoutModalEl = document.getElementById('logoutModal');

      if (logoutCancelBtn) {
        logoutCancelBtn.addEventListener('click', ()=> {
          if (logoutModalEl) logoutModalEl.classList.remove('active');
        });
      }
      
      // Fechar modal clicando fora
      if (logoutModalEl) {
        logoutModalEl.addEventListener('click', (e) => {
          if (e.target.id === 'logoutModal') {
            logoutModalEl.classList.remove('active');
          }
        });
      }
      
      if (logoutConfirmBtn) {
        logoutConfirmBtn.addEventListener('click', async ()=> {
          try { 
            await fetch('/api/admin/logout', { 
              method: 'POST',
              credentials: 'include'
            });
          } catch(e) { 
            console.error('Erro ao fazer logout:', e);
          } finally {
            window.location.href = '/admin-login.html';
          }
        });
      }
    }, 100);

    document.getElementById('navLogout').addEventListener('click', () => {
      document.getElementById('logoutModal').classList.add('active');
    });
  </script>
  <!-- Modal Profissional -->
  <div class="modal-overlay" id="logoutModal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-header-icon">Sair do Painel</span>
        <h2 class="modal-header-title">üîê</h2>
      </div>
      <div class="modal-body">
        <p class="modal-body-title">Deseja sair do Painel Administrativo?</p>
        <p class="modal-body-text">Voc√™ precisar√° fazer login novamente para acessar.</p>
      </div>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-confirm" id="logoutConfirm">Sair</button>
        <button class="modal-btn modal-btn-cancel" id="logoutCancel">Cancelar</button>        
      </div>
    </div>
  </div>

  <script src="admin.js" defer></script>
</body>
</html>